<p class="text-xl font-semibold text-center mb-2">Add new Supplement</p>

<form [formGroup]="form" (ngSubmit)="onSubmit()" class="flex flex-col gap-3">
  <lib-input formControlName="name" placeholder="Supp name"></lib-input>
  <lib-input
    orientation="vertical"
    formControlName="description"
    placeholder="Description"
  ></lib-input>

  <div class="flex gap-2">
    <input
      formControlName="stockQuantity"
      type="number"
      placeholder="Quantity per bottle"
      class="flex-1 max-h-12 border-primary-dark rounded-md focus:border-primary-light placeholder:text-sm"
    />

    <mat-form-field>
      <mat-label>Units</mat-label>
      <mat-select formControlName="quantityUnit">
        @for (unit of quantityUnits; track unit) {
          <mat-option [value]="unit">{{ unit }}</mat-option>
        }
      </mat-select>
    </mat-form-field>
  </div>

  <div class="flex gap-2">
    <input
      formControlName="servingSize"
      type="number"
      placeholder="Amount per serving"
      class="flex-1 max-h-12 border-primary-dark rounded-md focus:border-primary-light placeholder:text-sm"
    />
    <mat-form-field>
      <mat-label>Target</mat-label>
      <mat-select formControlName="healthTargets">
        @for (target of healthTargetKeys; track target) {
          <mat-option [value]="target">{{ target }}</mat-option>
        }
      </mat-select>
    </mat-form-field>
  </div>

  <div class="px-2">
    <p class="mb-3">Image</p>
    @if (previewUrl()) {
      <img
        class="h-40 w-full object-contain object-top rounded-lg"
        [src]="previewUrl()"
        alt="Supplement Image"
      />
    } @else {
      <div class="h-40 w-full rounded-lg bg-gray-background p-4 flex">
        <div
          class="flex-1 rounded-md flex items-center justify-center hover:bg-gray-200 hover:cursor-pointer transition-all duration-150"
        >
          <input
            type="file"
            accept="image/*"
            (change)="onFileInput($event)"
            #fileInput
            hidden
          />
          <button
            type="button"
            class="btn flex items-center gap-4"
            (click)="fileInput.click()"
          >
            Upload image
            <lib-icon
              [iconSize]="48"
              [iconColor]="'black'"
              [icon]="'add_a_photo'"
            ></lib-icon>
          </button>
        </div>
      </div>
    }
  </div>

  <div class="flex justify-center gap-3">
    <button lib-button appearance="transparent" type="submit" (click)="onDiscard()">
      Discard
    </button>
    <div class="bg-red-700 p-4 text-fuchsia-50">
      NEED TO CHANGE APPROACH - First add all supplements, then relate them to the user.
      dont 'create' new supplements here
    </div>
    <button lib-button appearance="fill" type="submit">Save</button>
  </div>
</form>
