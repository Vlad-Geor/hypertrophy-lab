@let data = cardData();

<div class="flex items-start gap-3">
  <lib-icon-tile [icon]="'box-liner'"></lib-icon-tile>
  <div class="flex flex-col gap-1 flex-grow">
    <div class="flex items-center justify-between">
      <div class="flex items-end gap-2">
        <span class="text-sm font-medium">{{ data?.name }}</span>
        @let units = data?.unitsPerDose;
        @if (units) {
          <lib-tag [rounded]="true" [size]="'sm'" [theme]="'secondary'">
            {{ units + ' ' + (units > 1 ? 'units' : 'unit') }}
          </lib-tag>
        }
      </div>
      @if (!showActions()) {
        <lib-icon-button
          (click)="inEditMode.set(true)"
          [inheritIconFillColor]="false"
          [icon]="'edit-liner'"
          size="sm"
        ></lib-icon-button>
      }
    </div>
    <div class="flex flex-col gap-1.5">
      <p class="text-gray-text font-medium text-xs truncate">
        {{ data?.notes }}
      </p>
      <div class="flex gap-2 justify-between">
        <p class="text-xs text-gray-dark">Stock: {{ data?.onHand }} remaining</p>
        @if (data?.inventorySource === 'group') {
          <lib-tag size="sm" theme="accent-purple">{{ data?.inventorySource }}</lib-tag>
        }
      </div>
    </div>
  </div>
</div>
@if (showActions()) {
  <div class="flex gap-3 justify-between">
    <lib-button
      appearance="outline"
      [fillContainer]="true"
      [asyncClick]="logSkipped"
      (next)="onLogSkipped($event)"
      (btnError)="onLogError($event)"
    >
      <lib-icon [icon]="'close-circle-liner'"></lib-icon>
      Skip
    </lib-button>

    <lib-button
      [asyncClick]="logTaken"
      (next)="onLogTaken($event)"
      (btnError)="onLogError($event)"
      theme="success-bright"
      [fillContainer]="true"
    >
      <lib-icon [icon]="'check-circle-broken-liner'"></lib-icon>
      Take
    </lib-button>
  </div>
} @else if (updatedLog().status === 'taken') {
  <lib-button theme="white" [fillContainer]="true" appearance="outline">
    <lib-icon class="text-success-bright" [icon]="'check-circle-broken-liner'"></lib-icon>
    Taken
  </lib-button>
} @else {
  <lib-button theme="white" [fillContainer]="true" appearance="outline">
    <lib-icon class="text-danger" [icon]="'close-circle-liner'"></lib-icon>
    Skipped
  </lib-button>
}
